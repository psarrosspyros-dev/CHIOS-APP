<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î”Î®Î¼Î¿Ï‚ Î§Î¯Î¿Ï… - Î•Î½Î¹Î±Î¯Î± Î¨Î·Ï†Î¹Î±ÎºÎ® Î ÏÎ»Î·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .nav-link { transition: all 0.2s ease-in-out; }
        .nav-link.active { color: #00A6FB; border-bottom-color: #00A6FB; }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #00A6FB; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .prose h2 { font-size: 1.25rem; font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .prose h3 { font-size: 1.1rem; font-weight: bold; margin-top: 1rem; margin-bottom: 0.25rem; }
        .prose ul { list-style-type: disc; margin-left: 1.5rem; }
        .prose li { margin-bottom: 0.25rem; }
        #map { height: 300px; border-radius: 0.5rem; border: 1px solid #ddd; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto max-w-4xl p-4">
        
        <header class="text-center my-8">
            <h1 class="text-4xl md:text-5xl font-black text-[#006494]">Î¨Î·Ï†Î¹Î±ÎºÎ® Î ÏÎ»Î· Î”Î®Î¼Î¿Ï… Î§Î¯Î¿Ï…</h1>
            <p class="text-lg text-gray-600 mt-2">Î— Ï€ÏŒÎ»Î· ÏƒÎ±Ï‚, ÏƒÏ„Î·Î½ Ï€Î±Î»Î¬Î¼Î· Ï„Î¿Ï… Ï‡ÎµÏÎ¹Î¿Ï ÏƒÎ±Ï‚.</p>
        </header>

        <nav class="bg-white rounded-lg shadow-md mb-8 sticky top-4 z-10">
            <div class="flex justify-around border-b">
                <button data-view="home" class="nav-link active w-full p-4 font-bold border-b-4">ğŸ  ÎšÎµÎ½Ï„ÏÎ¹ÎºÎ®</button>
                <button data-view="alerts" class="nav-link w-full p-4 font-bold border-b-4 border-transparent">ğŸ”” MyCity-Alert</button>
                <button data-view="fix" class="nav-link w-full p-4 font-bold border-b-4 border-transparent">ğŸ› ï¸ MyCity-Fix</button>
                <button data-view="plan" class="nav-link w-full p-4 font-bold border-b-4 border-transparent">âœ¨ MyCity-Plan</button>
            </div>
        </nav>

        <main>
            <!-- Home View -->
            <div id="home" class="view active">
                <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                    <h2 class="text-2xl font-bold text-[#006494] mb-4">ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ!</h2>
                    <p class="text-gray-700">Î‘Ï…Ï„Î® Î· ÎµÏ†Î±ÏÎ¼Î¿Î³Î® ÎµÎ¯Î½Î±Î¹ Î· ÎµÎ½Î¹Î±Î¯Î± ÏƒÎ±Ï‚ Ï€ÏÎ»Î· Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï„Î¿Ï… Î”Î®Î¼Î¿Ï… Î§Î¯Î¿Ï…. Î‘Ï€ÏŒ Ï„Î·Î½ Î¬Î¼ÎµÏƒÎ· ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î³Î¹Î± Î­ÎºÏ„Î±ÎºÏ„ÎµÏ‚ Î±Î½Î¬Î³ÎºÎµÏ‚ Î¼Î­Ï‡ÏÎ¹ Ï„Î·Î½ Î±Î½Î±Ï†Î¿ÏÎ¬ Ï€ÏÎ¿Î²Î»Î·Î¼Î¬Ï„Ï‰Î½ Ï„Î·Ï‚ ÎºÎ±Î¸Î·Î¼ÎµÏÎ¹Î½ÏŒÏ„Î·Ï„Î±Ï‚, ÏƒÏ„ÏŒÏ‡Î¿Ï‚ Î¼Î±Ï‚ ÎµÎ¯Î½Î±Î¹ Î½Î± ÎºÎ¬Î½Î¿Ï…Î¼Îµ Ï„Î·Î½ Ï€ÏŒÎ»Î· Î¼Î±Ï‚ Ï€Î¹Î¿ Î±ÏƒÏ†Î±Î»Î®, Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÎ® ÎºÎ±Î¹ ÏƒÏ…Î¼Î¼ÎµÏ„Î¿Ï‡Î¹ÎºÎ®. Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î¼Î¹Î± Î±Ï€ÏŒ Ï„Î¹Ï‚ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ ÎµÎ½ÏŒÏ„Î·Ï„ÎµÏ‚ Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÏ„Îµ.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="font-bold text-lg text-[#0582CA]">MyCity-Events</h3>
                        <p class="text-sm text-gray-600 mt-1 mb-3">Î Î¿Î»Î¹Ï„Î¹ÏƒÏ„Î¹ÎºÎ® Î‘Ï„Î¶Î­Î½Ï„Î±</p>
                        <ul>
                            <li class="border-b py-2">Î¦ÎµÏƒÏ„Î¹Î²Î¬Î» ÎœÎ±ÏƒÏ„Î¯Ï‡Î±Ï‚ - Î£Ï…Î½Î±Ï…Î»Î¯Î± <span class="text-xs bg-blue-100 text-blue-800 p-1 rounded">Î£Î®Î¼ÎµÏÎ±</span></li>
                            <li class="border-b py-2">ÎˆÎºÎ¸ÎµÏƒÎ· Î–Ï‰Î³ÏÎ±Ï†Î¹ÎºÎ®Ï‚ ÏƒÏ„Î¿ Î”Î·Î¼Î±ÏÏ‡ÎµÎ¯Î¿</li>
                            <li class="py-2">Î‘Î³ÏÎ½Î±Ï‚ Î”ÏÏŒÎ¼Î¿Ï… "Chios Run"</li>
                        </ul>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="font-bold text-lg text-[#0582CA]">MyCity-Engage</h3>
                        <p class="text-sm text-gray-600 mt-1 mb-3">Î£Ï…Î¼Î¼ÎµÏ„Î¿Ï‡Î¹ÎºÎ® Î”Î·Î¼Î¿ÎºÏÎ±Ï„Î¯Î±</p>
                        <p class="mb-2">ğŸ“£ **Î£Îµ Î´Î¹Î±Î²Î¿ÏÎ»ÎµÏ…ÏƒÎ·:** Î‘Î½Î¬Ï€Î»Î±ÏƒÎ· Ï€Î±ÏÎ±Î»Î¹Î±ÎºÎ¿Ï Î¼ÎµÏ„ÏÏ€Î¿Ï…. <a href="#" class="text-blue-600 hover:underline">Î”ÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ±</a>.</p>
                        <p>ğŸ¤ **Î•Î¸ÎµÎ»Î¿Î½Ï„Î¹ÏƒÎ¼ÏŒÏ‚:** ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï€Î±ÏÎ±Î»Î¯Î±Ï‚ ÎšÏÎ¼Î·Ï‚. <a href="#" class="text-blue-600 hover:underline">Î”Î·Î»ÏÏƒÏ„Îµ ÏƒÏ…Î¼Î¼ÎµÏ„Î¿Ï‡Î®</a>.</p>
                    </div>
                </div>
            </div>

            <!-- Alerts View -->
            <div id="alerts" class="view">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-[#006494] mb-4">MyCity-Alert: Î•Ï…Ï†Ï…ÎµÎ¯Ï‚ Î•Î¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚</h2>
                    <p class="text-gray-700 mb-6">Î•Î´Ï Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î· Ï„ÎµÏ‡Î½Î·Ï„Î® Î½Î¿Î·Î¼Î¿ÏƒÏÎ½Î· Î¼ÎµÏ„Î±Ï„ÏÎ­Ï€ÎµÎ¹ Ï„ÎµÏ‡Î½Î¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎµ ÏƒÎ±Ï†ÎµÎ¯Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ Î³Î¹Î± Ï„Î·Î½ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î¬ ÏƒÎ±Ï‚.</p>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg mb-6">
                        <h4 class="font-bold">Î”Ï…Î½Î±Î¼Î¹ÎºÎ® Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î•Î¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚</h4>
                        <div class="mt-4">
                            <p class="font-semibold text-gray-500 text-sm">Î‘ÏÏ‡Î¹ÎºÎ¬ Î¤ÎµÏ‡Î½Î¹ÎºÎ¬ Î”ÎµÎ´Î¿Î¼Î­Î½Î±:</p>
                            <p id="rawData" class="text-sm bg-gray-200 p-2 rounded font-mono">EVENT:FIRE; LOC:40.12,26.05; WIND:5BF; DIR:NE; RISK:HIGH; ACTION:PREP_EVAC</p>
                        </div>
                        <div class="mt-4">
                            <p class="font-semibold text-gray-500 text-sm">Î•Î¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î•Î½Î¹ÏƒÏ‡Ï…Î¼Î­Î½Î· Î±Ï€ÏŒ AI:</p>
                            <div id="geminiAlert" class="bg-yellow-100 border border-yellow-400 text-yellow-800 p-3 rounded min-h-[100px] flex items-center justify-center text-center">
                                <span class="text-gray-500">Î Î±Ï„Î®ÏƒÏ„Îµ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ Î³Î¹Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±...</span>
                            </div>
                            <div class="flex items-center mt-2">
                                <button id="generateAlertBtn" class="bg-[#00A6FB] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#0582CA] transition-colors flex items-center justify-center">
                                    <span id="generateAlertBtnText">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±</span>
                                    <div id="generateAlertLoader" class="loader hidden ml-2"></div>
                                </button>
                                <button id="readAloudBtn" class="ml-4 p-2 rounded-full hover:bg-gray-200 disabled:opacity-50" title="Î—Ï‡Î·Ï„Î¹ÎºÎ® Î‘Î½Î¬Î³Î½Ï‰ÏƒÎ·" disabled>ğŸ”Š</button>
                            </div>
                            <p id="tts-error" class="text-xs text-red-500 mt-2 hidden"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fix View -->
            <div id="fix" class="view">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-[#006494] mb-4">MyCity-Fix: Î‘Î½Î±Ï†Î¿ÏÎ¬ Î ÏÎ¿Î²Î»Î·Î¼Î¬Ï„Ï‰Î½</h2>
                    <p class="text-gray-700 mb-6">Î•Î½Ï„Î¿Ï€Î¯ÏƒÎ±Ï„Îµ Î­Î½Î± Ï€ÏÏŒÎ²Î»Î·Î¼Î±; Î•Î½Î·Î¼ÎµÏÏÏƒÏ„Îµ Î¼Î±Ï‚ Î¬Î¼ÎµÏƒÎ± Î³Î¹Î± Î½Î± Ï„Î¿ ÎµÏ€Î¹Î»ÏÏƒÎ¿Ï…Î¼Îµ.</p>
                    <form id="fixit-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± ÏƒÏ„Î¿Î½ Ï‡Î¬ÏÏ„Î·</label>
                            <div id="map" class="mt-1"></div>
                            <input type="hidden" id="coordinates">
                        </div>
                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700">Î ÎµÏÎ¹Î³ÏÎ±Ï†Î® Î ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î¿Ï‚</label>
                            <textarea id="description" rows="3" class="mt-1 block w-full p-2 border border-gray-300 rounded-md" placeholder="Ï€.Ï‡. ÎœÎµÎ³Î¬Î»Î· Î»Î±ÎºÎºÎ¿ÏÎ²Î± ÎµÏ€Î¹ÎºÎ¯Î½Î´Ï…Î½Î· Î³Î¹Î± Î¿Ï‡Î®Î¼Î±Ï„Î±..."></textarea>
                        </div>
                         <div>
                            <label for="issue-type" class="block text-sm font-medium text-gray-700">Î•Î¯Î´Î¿Ï‚ Î ÏÎ¿Î²Î»Î®Î¼Î±Ï„Î¿Ï‚</label>
                            <div class="flex items-center gap-2 mt-1">
                                <select id="issue-type" class="block w-full p-2 border border-gray-300 rounded-md">
                                    <option value="">Î•Ï€Î¹Î»Î­Î¾Ï„Îµ...</option>
                                    <option>Î›Î±ÎºÎºÎ¿ÏÎ²Î± ÏƒÏ„Î¿ Î¿Î´ÏŒÏƒÏ„ÏÏ‰Î¼Î±</option>
                                    <option>ÎšÎ±Î¼Î­Î½Î¿Ï‚ Î»Î±Î¼Ï€Ï„Î®ÏÎ±Ï‚</option>
                                    <option>Î‘Ï€Î¿ÏÏÎ¯Î¼Î¼Î±Ï„Î±</option>
                                    <option>Î•Î³ÎºÎ±Ï„Î±Î»ÎµÎ»ÎµÎ¹Î¼Î¼Î­Î½Î¿ ÏŒÏ‡Î·Î¼Î±</option>
                                    <option>Î†Î»Î»Î¿</option>
                                </select>
                                <button type="button" id="categorizeBtn" class="p-2 bg-gray-200 rounded-md hover:bg-gray-300" title="Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎšÎ±Ï„Î·Î³Î¿ÏÎ¹Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ AI">ğŸ¤–</button>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-[#00A6FB] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#0582CA] transition-colors">Î¥Ï€Î¿Î²Î¿Î»Î® Î‘Î½Î±Ï†Î¿ÏÎ¬Ï‚</button>
                    </form>
                    <div id="form-success" class="hidden mt-4 text-center p-4 bg-green-100 text-green-800 rounded-lg">Î— Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÎ±Ï‚ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®Î¸Î·ÎºÎµ!</div>
                    <div id="fix-error" class="hidden mt-4 text-center p-4 bg-red-100 text-red-800 rounded-lg"></div>
                </div>
                <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold text-[#006494] mb-4">ÎŸÎ¹ Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚ Î¼Î¿Ï…</h3>
                    <div id="my-reports" class="space-y-3">
                        <div class="p-3 bg-gray-50 rounded-md border flex justify-between items-center">
                            <div>
                                <p class="font-semibold">Î›Î±ÎºÎºÎ¿ÏÎ²Î± ÏƒÏ„Î¿ Î¿Î´ÏŒÏƒÏ„ÏÏ‰Î¼Î±</p>
                                <p class="text-xs text-gray-500">ÎŸÎ´ÏŒÏ‚ Î‘ÏÎ³Î­Î½Ï„Î·</p>
                            </div>
                            <span class="text-sm font-medium text-green-600 bg-green-100 px-2 py-1 rounded-full">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ</span>
                        </div>
                         <div class="p-3 bg-gray-50 rounded-md border flex justify-between items-center">
                            <div>
                                <p class="font-semibold">ÎšÎ±Î¼Î­Î½Î¿Ï‚ Î»Î±Î¼Ï€Ï„Î®ÏÎ±Ï‚</p>
                                <p class="text-xs text-gray-500">Î Î»Î±Ï„ÎµÎ¯Î± Î’Î¿Ï…Î½Î±ÎºÎ¯Î¿Ï…</p>
                            </div>
                            <span class="text-sm font-medium text-yellow-600 bg-yellow-100 px-2 py-1 rounded-full">Î£Îµ ÎµÎ¾Î­Î»Î¹Î¾Î·</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plan View -->
            <div id="plan" class="view">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-2xl font-bold text-[#006494] mb-4">MyCity-Plan: Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ Î£Ï‡Î­Î´Î¹Î¿ Î‘Î½Î¬Î³ÎºÎ·Ï‚</h2>
                    <p class="text-gray-700 mb-6">Î— ÎµÏ„Î¿Î¹Î¼ÏŒÏ„Î·Ï„Î± Î¾ÎµÎºÎ¹Î½Î¬ Î±Ï€ÏŒ Ï„Î¿ ÏƒÏ€Î¯Ï„Î¹. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î­Î½Î± ÎµÎ¾Î±Ï„Î¿Î¼Î¹ÎºÎµÏ…Î¼Î­Î½Î¿ ÏƒÏ‡Î­Î´Î¹Î¿ Î´ÏÎ¬ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î¼Î¹Î± Î»Î¯ÏƒÏ„Î± ÎµÎ»Î­Î³Ï‡ou Î³Î¹Î± Ï„Î¿ ÏƒÎ±ÎºÎ¯Î´Î¹Î¿ Î­ÎºÏ„Î±ÎºÏ„Î·Ï‚ Î±Î½Î¬Î³ÎºÎ·Ï‚.</p>
                     <div class="bg-amber-50 border-l-4 border-amber-500 p-4 rounded-r-lg mb-6">
                        <h4 class="font-bold mb-3">1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î£Ï‡ÎµÎ´Î¯Î¿Ï… Î”ÏÎ¬ÏƒÎ·Ï‚</h4>
                        <div class="space-y-3">
                            <div><label for="area-type" class="block text-sm font-medium text-gray-700">Î¤ÏÏ€Î¿Ï‚ Î ÎµÏÎ¹Î¿Ï‡Î®Ï‚</label><select id="area-type" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"><option value="urban">Î‘ÏƒÏ„Î¹ÎºÎ®</option><option value="rural">Î‘Î³ÏÎ¿Ï„Î¹ÎºÎ®/ÎŸÏÎµÎ¹Î½Î®</option><option value="coastal">Î Î±ÏÎ¬ÎºÏ„Î¹Î±</option></select></div>
                            <div><label for="adults" class="block text-sm font-medium text-gray-700">Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î•Î½Î·Î»Î¯ÎºÏ‰Î½</label><input type="number" id="adults" value="2" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></div>
                            <div><label for="children" class="block text-sm font-medium text-gray-700">Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ Î Î±Î¹Î´Î¹ÏÎ½</label><input type="number" id="children" value="1" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></div>
                            <div><label for="disabilities" class="block text-sm font-medium text-gray-700">Î†Ï„Î¿Î¼Î± Î¼Îµ ÎºÎ¹Î½Î·Ï„Î¹ÎºÎ­Ï‚ Î´Ï…ÏƒÎºÎ¿Î»Î¯ÎµÏ‚;</label><select id="disabilities" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"><option value="no">ÎŒÏ‡Î¹</option><option value="yes">ÎÎ±Î¹</option></select></div>
                            <!-- FIX: Added disaster type selection -->
                            <div><label for="disaster-type" class="block text-sm font-medium text-gray-700">Î•Ï€Î¹Î»Î¿Î³Î® ÎšÎ¹Î½Î´ÏÎ½Î¿Ï…</label><select id="disaster-type" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"><option value="Î£ÎµÎ¹ÏƒÎ¼ÏŒÏ‚">Î£ÎµÎ¹ÏƒÎ¼ÏŒÏ‚</option><option value="Î Ï…ÏÎºÎ±Î³Î¹Î¬">Î Ï…ÏÎºÎ±Î³Î¹Î¬</option><option value="Î Î»Î·Î¼Î¼ÏÏÎ±">Î Î»Î·Î¼Î¼ÏÏÎ±</option></select></div>
                        </div>
                        <button id="generatePlanBtn" class="mt-4 w-full bg-[#F7B801] text-[#006494] font-bold py-2 px-4 rounded-lg hover:bg-amber-400 transition-colors flex items-center justify-center">
                            <span id="generatePlanBtnText">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î£Ï‡ÎµÎ´Î¯Î¿Ï… Î”ÏÎ¬ÏƒÎ·Ï‚</span>
                            <div id="generatePlanLoader" class="loader hidden ml-3"></div>
                        </button>
                    </div>
                     <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
                        <h4 class="font-bold mb-3">2. Î›Î¯ÏƒÏ„Î± Î•Î»Î­Î³Ï‡Î¿Ï… "Go-Bag"</h4>
                        <p class="text-sm text-gray-600 mb-3">Î Î±Ï„Î®ÏƒÏ„Îµ Ï„Î¿ ÎºÎ¿Ï…Î¼Ï€Î¯ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î· AI Î¼Î¹Î± ÎµÎ¾Î±Ï„Î¿Î¼Î¹ÎºÎµÏ…Î¼Î­Î½Î·, Î´Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÎ® Î»Î¯ÏƒÏ„Î± ÎµÎ»Î­Î³Ï‡Î¿Ï… Î³Î¹Î± Ï„Î¿ ÏƒÎ±ÎºÎ¯Î´Î¹Î¿ Î­ÎºÏ„Î±ÎºÏ„Î·Ï‚ Î±Î½Î¬Î³ÎºÎ·Ï‚ Ï„Î·Ï‚ Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î¬Ï‚ ÏƒÎ±Ï‚.</p>
                        <button id="generateChecklistBtn" class="w-full bg-[#00A6FB] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#0582CA] transition-colors flex items-center justify-center">
                            <span id="generateChecklistBtnText">Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î›Î¯ÏƒÏ„Î±Ï‚ Î•Î»Î­Î³Ï‡ou</span>
                            <div id="generateChecklistLoader" class="loader hidden ml-3"></div>
                        </button>
                    </div>
                    <div id="plan-error" class="hidden mt-4 text-center p-4 bg-red-100 text-red-800 rounded-lg"></div>
                </div>
                 <div id="planResultCard" class="mt-8 bg-white p-6 rounded-lg shadow-md hidden">
                    <h3 class="text-2xl font-bold text-[#006494] mb-4">Î¤Î¿ Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ ÏƒÎ±Ï‚ Î£Ï‡Î­Î´Î¹Î¿ Î”ÏÎ¬ÏƒÎ·Ï‚</h3>
                    <div id="planResult" class="prose max-w-none text-gray-800"></div>
                </div>
                 <div id="checklistResultCard" class="mt-8 bg-white p-6 rounded-lg shadow-md hidden">
                    <h3 class="text-2xl font-bold text-[#006494] mb-4">Î›Î¯ÏƒÏ„Î± Î•Î»Î­Î³Ï‡Î¿Ï… "Go-Bag"</h3>
                    <div id="checklistResult" class="space-y-4"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Navigation Logic
            const navLinks = document.querySelectorAll('.nav-link');
            const views = document.querySelectorAll('.view');
            let map;

            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const viewId = link.dataset.view;
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    link.classList.add('active');
                    views.forEach(view => {
                        view.classList.remove('active');
                        if (view.id === viewId) {
                            view.classList.add('active');
                        }
                    });
                    if (viewId === 'fix' && !map) {
                        setTimeout(initMap, 0);
                    }
                });
            });

            // MyCity-Fix Form Logic
            const fixitForm = document.getElementById('fixit-form');
            const formSuccess = document.getElementById('form-success');
            fixitForm.addEventListener('submit', (e) => {
                e.preventDefault();
                formSuccess.classList.remove('hidden');
                fixitForm.reset();
                setTimeout(() => { formSuccess.classList.add('hidden'); }, 5000);
            });

            // Gemini API Integration
            const apiKey = "";
            const apiUrlText = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const apiUrlTts = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
            let currentAlertText = '';
            let audioContext;

            const exponentialBackoff = async (apiCall, maxRetries = 5) => {
                let delay = 1000;
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await apiCall();
                        if (response.ok) { return response.json(); }
                    } catch (error) { /* Network or other errors */ }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
                throw new Error("API call failed after multiple retries.");
            };
            
            // Map Initialization
            function initMap() {
                map = L.map('map').setView([38.3733, 26.1383], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
                let marker;
                map.on('click', function(e) {
                    if (marker) {
                        map.removeLayer(marker);
                    }
                    marker = L.marker(e.latlng).addTo(map);
                    document.getElementById('coordinates').value = `${e.latlng.lat}, ${e.latlng.lng}`;
                });
            }

            // Alerts View Logic
            const generateAlertBtn = document.getElementById('generateAlertBtn');
            const generateAlertBtnText = document.getElementById('generateAlertBtnText');
            const generateAlertLoader = document.getElementById('generateAlertLoader');
            const geminiAlertDiv = document.getElementById('geminiAlert');
            const readAloudBtn = document.getElementById('readAloudBtn');
            const ttsError = document.getElementById('tts-error');

            generateAlertBtn.addEventListener('click', async () => {
                generateAlertBtn.disabled = true;
                generateAlertLoader.classList.remove('hidden');
                generateAlertBtnText.textContent = 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±...';
                readAloudBtn.disabled = true;
                const rawData = document.getElementById('rawData').textContent;
                const prompt = `Act as a civil protection expert. Your task is to translate the following raw alert data into a clear, calm, and actionable message in Greek for the public. The message should be concise and easy to understand under pressure. Raw data: "${rawData}"`;
                try {
                    const result = await exponentialBackoff(() => fetch(apiUrlText, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) }));
                    if (result.candidates && result.candidates.length > 0) {
                        currentAlertText = result.candidates[0].content.parts[0].text;
                        geminiAlertDiv.innerHTML = currentAlertText.replace(/\n/g, '<br>');
                        readAloudBtn.disabled = false;
                    } else {
                        geminiAlertDiv.textContent = 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î·Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚.';
                        currentAlertText = '';
                    }
                } catch (error) {
                    geminiAlertDiv.innerHTML = '<strong>Î‘Î´Ï…Î½Î±Î¼Î¯Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± AI.</strong><br><small>Î‘Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ ÏŒÏ„Î±Î½ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¬, Î»ÏŒÎ³Ï‰ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏÎ½ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï„Î¿Ï… browser.</small>';
                    currentAlertText = '';
                } finally {
                    generateAlertBtn.disabled = false;
                    generateAlertLoader.classList.add('hidden');
                    generateAlertBtnText.textContent = 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±';
                }
            });
            
            readAloudBtn.addEventListener('click', async () => {
                if (!currentAlertText) return;
                ttsError.classList.add('hidden');
                if (!audioContext) { audioContext = new (window.AudioContext || window.webkitAudioContext)(); }
                const payload = { contents: [{ parts: [{ text: `Say in a clear and calm voice in Greek: ${currentAlertText}` }] }], generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } } }, model: "gemini-2.5-flash-preview-tts" };
                try {
                    const result = await exponentialBackoff(() => fetch(apiUrlTts, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }));
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;
                    if (audioData && mimeType && mimeType.startsWith("audio/")) {
                        const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        new Audio(audioUrl).play();
                    } else {
                        ttsError.textContent = 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… Î®Ï‡Î¿Ï….';
                        ttsError.classList.remove('hidden');
                    }
                } catch (error) {
                    ttsError.textContent = 'Î‘Î´Ï…Î½Î±Î¼Î¯Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Î®Ï‡Î¿Ï….';
                    ttsError.classList.remove('hidden');
                }
            });
            
            // MyCity-Fix AI Categorization
            const categorizeBtn = document.getElementById('categorizeBtn');
            const fixError = document.getElementById('fix-error');
            categorizeBtn.addEventListener('click', async () => {
                const description = document.getElementById('description').value;
                fixError.classList.add('hidden');
                if (!description.trim()) {
                    fixError.textContent = 'Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Î¼Î¹Î± Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î® Ï€ÏÏÏ„Î±.';
                    fixError.classList.remove('hidden');
                    return;
                }
                const prompt = `Analyze the following user report from Chios, Greece, and categorize it into one of these exact categories: "Î›Î±ÎºÎºÎ¿ÏÎ²Î± ÏƒÏ„Î¿ Î¿Î´ÏŒÏƒÏ„ÏÏ‰Î¼Î±", "ÎšÎ±Î¼Î­Î½Î¿Ï‚ Î»Î±Î¼Ï€Ï„Î®ÏÎ±Ï‚", "Î‘Ï€Î¿ÏÏÎ¯Î¼Î¼Î±Ï„Î±", "Î•Î³ÎºÎ±Ï„Î±Î»ÎµÎ»ÎµÎ¹Î¼Î¼Î­Î½Î¿ ÏŒÏ‡Î·Î¼Î±", "Î†Î»Î»Î¿". Respond with only the category name. Report: "${description}"`;
                try {
                    const result = await exponentialBackoff(() => fetch(apiUrlText, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) }));
                    if (result.candidates && result.candidates.length > 0) {
                        const category = result.candidates[0].content.parts[0].text.trim();
                        const selectElement = document.getElementById('issue-type');
                        const optionExists = [...selectElement.options].some(opt => opt.value === category);
                        selectElement.value = optionExists ? category : "Î†Î»Î»Î¿";
                    }
                } catch (error) {
                    fixError.textContent = 'Î‘Î´Ï…Î½Î±Î¼Î¯Î± Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î·Ï‚ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¹Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î»ÏŒÎ³Ï‰ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î¿Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚.';
                    fixError.classList.remove('hidden');
                }
            });

            // Plan View Logic
            const generatePlanBtn = document.getElementById('generatePlanBtn');
            const generatePlanBtnText = document.getElementById('generatePlanBtnText');
            const generatePlanLoader = document.getElementById('generatePlanLoader');
            const planResultCard = document.getElementById('planResultCard');
            const planResultDiv = document.getElementById('planResult');
            const generateChecklistBtn = document.getElementById('generateChecklistBtn');
            const generateChecklistBtnText = document.getElementById('generateChecklistBtnText');
            const generateChecklistLoader = document.getElementById('generateChecklistLoader');
            const checklistResultCard = document.getElementById('checklistResultCard');
            const checklistResultDiv = document.getElementById('checklistResult');
            const planError = document.getElementById('plan-error');

            generatePlanBtn.addEventListener('click', async () => {
                generatePlanBtn.disabled = true;
                generatePlanLoader.classList.remove('hidden');
                generatePlanBtnText.textContent = 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±...';
                planResultCard.classList.add('hidden');
                planError.classList.add('hidden');
                const adults = document.getElementById('adults').value;
                const children = document.getElementById('children').value;
                const disabilities = document.getElementById('disabilities').value;
                const areaType = document.getElementById('area-type').value;
                // FIX: Read the selected disaster type
                const disasterType = document.getElementById('disaster-type').value;
                
                // FIX: Update the prompt to include the selected disaster type
                const prompt = `Act as a Greek civil protection expert. Create a personalized family emergency plan for a family in Chios, Greece. The plan must focus specifically on the risk of: ${disasterType}.
                
                The plan should be clear, concise, and easy to follow. Use markdown for formatting (headings, lists). The family consists of:
                - Adults: ${adults}
                - Children: ${children}
                - Individuals with mobility issues: ${disabilities === 'yes' ? 'Yes' : 'No'}
                - Area Type: ${areaType}

                Provide step-by-step instructions for:
                1. **Preparation (Î ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î±):** What to do before the ${disasterType} happens.
                2. **During the Event (ÎšÎ±Ï„Î¬ Ï„Î· Î”Î¹Î¬ÏÎºÎµÎ¹Î±):** What to do when the ${disasterType} is happening.
                3. **After the Event (ÎœÎµÏ„Î¬ Ï„Î¿ Î£Ï…Î¼Î²Î¬Î½):** What to do after the ${disasterType} has passed.

                Tailor the advice based on the family composition and area type. The tone should be reassuring but authoritative. Generate the response in Greek.`;
                try {
                    const result = await exponentialBackoff(() => fetch(apiUrlText, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) }));
                    if (result.candidates && result.candidates.length > 0) {
                        const planText = result.candidates[0].content.parts[0].text;
                        planResultDiv.innerHTML = markdownToHtml(planText);
                        planResultCard.classList.remove('hidden');
                        planResultCard.scrollIntoView({ behavior: 'smooth' });
                    } else { 
                        planError.textContent = 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… ÏƒÏ‡ÎµÎ´Î¯Î¿Ï….';
                        planError.classList.remove('hidden');
                    }
                } catch (error) { 
                    planError.innerHTML = '<strong>Î‘Î´Ï…Î½Î±Î¼Î¯Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± AI.</strong><br><small>Î‘Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ ÏŒÏ„Î±Î½ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¬, Î»ÏŒÎ³Ï‰ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏÎ½ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï„Î¿Ï… browser.</small>';
                    planError.classList.remove('hidden');
                } finally {
                    generatePlanBtn.disabled = false;
                    generatePlanLoader.classList.add('hidden');
                    generatePlanBtnText.textContent = 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î£Ï‡ÎµÎ´Î¯Î¿Ï… Î”ÏÎ¬ÏƒÎ·Ï‚';
                }
            });

            generateChecklistBtn.addEventListener('click', async () => {
                generateChecklistBtn.disabled = true;
                generateChecklistLoader.classList.remove('hidden');
                generateChecklistBtnText.textContent = 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±...';
                checklistResultCard.classList.add('hidden');
                planError.classList.add('hidden');
                const adults = document.getElementById('adults').value;
                const children = document.getElementById('children').value;
                const prompt = `Create a detailed "go-bag" checklist for a family in Greece. Family composition: ${adults} adults, ${children} children. The output must be a JSON object. The root object should have a key "checklist" which is an array of category objects. Each category object must have two keys: "category" (string, in Greek) and "items" (an array of strings, each string being a checklist item in Greek). Categories should include "Î’Î±ÏƒÎ¹ÎºÎ¬ ÎˆÎ³Î³ÏÎ±Ï†Î±", "Î ÏÏÏ„ÎµÏ‚ Î’Î¿Î®Î¸ÎµÎ¹ÎµÏ‚", "Î¤ÏÏŒÏ†Î¹Î¼Î± & ÎÎµÏÏŒ", "Î ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ¬ Î•Î¯Î´Î· & Î¡Î¿Ï…Ï‡Î¹ÏƒÎ¼ÏŒÏ‚", and "Î•ÏÎ³Î±Î»ÎµÎ¯Î± & Î•Î¾Î¿Ï€Î»Î¹ÏƒÎ¼ÏŒÏ‚". Tailor items based on the family size.`;
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { responseMimeType: "application/json", responseSchema: { type: "OBJECT", properties: { checklist: { type: "ARRAY", items: { type: "OBJECT", properties: { category: { type: "STRING" }, items: { type: "ARRAY", items: { type: "STRING" } } } } } } } }
                };
                try {
                    const result = await exponentialBackoff(() => fetch(apiUrlText, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }));
                    if (result.candidates && result.candidates.length > 0) {
                        const jsonResponse = JSON.parse(result.candidates[0].content.parts[0].text);
                        renderChecklist(jsonResponse.checklist);
                        checklistResultCard.classList.remove('hidden');
                        checklistResultCard.scrollIntoView({ behavior: 'smooth' });
                    } else { 
                        planError.textContent = 'Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î·Ï‚ Î»Î¯ÏƒÏ„Î±Ï‚.';
                        planError.classList.remove('hidden');
                    }
                } catch (error) { 
                    planError.innerHTML = '<strong>Î‘Î´Ï…Î½Î±Î¼Î¯Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± AI Î³Î¹Î± Ï„Î· Î»Î¯ÏƒÏ„Î±.</strong><br><small>Î‘Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ ÏŒÏ„Î±Î½ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Ï„Î¿Ï€Î¹ÎºÎ¬, Î»ÏŒÎ³Ï‰ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏÎ½ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï„Î¿Ï… browser.</small>';
                    planError.classList.remove('hidden');
                } finally {
                    generateChecklistBtn.disabled = false;
                    generateChecklistLoader.classList.add('hidden');
                    generateChecklistBtnText.textContent = 'Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î›Î¯ÏƒÏ„Î±Ï‚ Î•Î»Î­Î³Ï‡Î¿Ï…';
                }
            });
            
            function renderChecklist(checklistData) {
                checklistResultDiv.innerHTML = '';
                checklistData.forEach(category => {
                    const categoryDiv = document.createElement('div');
                    const categoryTitle = document.createElement('h4');
                    categoryTitle.className = 'text-lg font-bold text-[#006494] mt-4 border-b pb-1';
                    categoryTitle.textContent = category.category;
                    categoryDiv.appendChild(categoryTitle);
                    const itemList = document.createElement('div');
                    itemList.className = 'mt-2 space-y-2';
                    category.items.forEach(item => {
                        const itemLabel = document.createElement('label');
                        itemLabel.className = 'flex items-center p-2 bg-gray-50 rounded-md hover:bg-gray-100 cursor-pointer';
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.className = 'h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500';
                        const itemText = document.createElement('span');
                        itemText.className = 'ml-3 text-gray-700';
                        itemText.textContent = item;
                        itemLabel.appendChild(checkbox);
                        itemLabel.appendChild(itemText);
                        itemList.appendChild(itemLabel);
                    });
                    categoryDiv.appendChild(itemList);
                    checklistResultDiv.appendChild(categoryDiv);
                });
            }
            
            // Utility Functions
            function base64ToArrayBuffer(base64) { const binaryString = window.atob(base64); const len = binaryString.length; const bytes = new Uint8Array(len); for (let i = 0; i < len; i++) { bytes[i] = binaryString.charCodeAt(i); } return bytes.buffer; }
            function pcmToWav(pcm, sampleRate) { const numChannels = 1, bitsPerSample = 16, blockAlign = numChannels * bitsPerSample / 8; const byteRate = sampleRate * blockAlign, dataSize = pcm.length * pcm.BYTES_PER_ELEMENT; const buffer = new ArrayBuffer(44 + dataSize); const view = new DataView(buffer); function writeString(view, offset, string) { for (let i = 0; i < string.length; i++) { view.setUint8(offset + i, string.charCodeAt(i)); } } writeString(view, 0, 'RIFF'); view.setUint32(4, 36 + dataSize, true); writeString(view, 8, 'WAVE'); writeString(view, 12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, numChannels, true); view.setUint32(24, sampleRate, true); view.setUint32(28, byteRate, true); view.setUint16(32, blockAlign, true); view.setUint16(34, bitsPerSample, true); writeString(view, 36, 'data'); view.setUint32(40, dataSize, true); for (let i = 0; i < pcm.length; i++) { view.setInt16(44 + i * 2, pcm[i], true); } return new Blob([view], { type: 'audio/wav' }); }
            function markdownToHtml(text) { let html = text.replace(/^### (.*$)/gim, '<h3>$1</h3>').replace(/^## (.*$)/gim, '<h2>$1</h2>').replace(/\*\*(.*)\*\*/g, '<strong>$1</strong>').replace(/\*(.*)\*/g, '<em>$1</em>'); const lines = html.split('\n'); let inList = false; let listType = ''; let listHtml = ''; for(let line of lines) { const isUl = line.trim().startsWith('* '); const isOl = line.trim().match(/^\d+\. /); if (isUl || isOl) { const currentType = isUl ? 'ul' : 'ol'; if (!inList || listType !== currentType) { if (inList) { listHtml += `</${listType}>`; } inList = true; listType = currentType; listHtml += `<${listType}>`; } listHtml += `<li>${line.trim().substring(line.indexOf(' ') + 1)}</li>`; } else { if (inList) { inList = false; listHtml += `</${listType}>`; } listHtml += `<p>${line}</p>`; } } if (inList) { listHtml += `</${listType}>`; } return listHtml.replace(/<p><\/p>/g, ''); }
        });
    </script>
</body>
</html>
